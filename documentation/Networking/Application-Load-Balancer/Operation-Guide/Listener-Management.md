# 监听器管理

[添加监听器](listener-management#user-content-1)

[管理监听器](listener-management#user-content-2)

[编辑监听器](listener-management#user-content-3)

[管理监听器关联的转发规则组](listener-management#user-content-4)

[管理证书](listener-management#user-content-5)

## 添加监听器
<div id="user-content-1"></div>

1. 通过应用负载均衡-详情-监听器进入监听器管理页；

2. 点击新建监听器，打开监听器设置页；

3. 监听器设置：
	
	**前端监听配置：**
	
	- 选择前端监听协议：http、https、tcp、tls、udp；端口：1-65534，端口65535被系统预留使用，不允许配置；	
		注：同一应用负载均衡下的监听端口不可重复，监听器创建后，监听协议、端口不允许修改；	
	- 空闲连接超时：输入范围1-86400秒；

            > 当配置https和tls协议时，需选择使用的ssl证书，支持配置RSA和ECC双证书，负载均衡可以根据客户端请求返回不同加密算法的证书。
            > 当配置https协议时，支持开启HSTS功能，强制客户端使用HTTPS与负载均衡进行通信，降低客户端第一次访问后端服务被劫持的风险，提高业务的安全性

		![ALB前端监听配置](../../../../image/Networking/ALB/ALB-022.png)

	**后端转发配置：**

	- 默认后端服务：新建或选择一个已有的后端服务，选择已有后端服务相关参数不可修改；
	
	- 后端服务名称：定义后端服务名称，随监听器同步创建的后端服务可在后端服务列表查看；	
	
	- 后端协议：对应选择的监听器协议，默认显示。监听协议为http、https则后端协议为http；监听协议为tcp、tls则后端协议为tcp；监听协议为udp则后端协议为udp。
	
	- 端口：后端业务转发端口，输入范围1-65535，不同后端服务的端口可以重复；
	
	- 调度算法：加权轮询、加权最小连接数、加权源IP，可根据实际业务需求选择；
	
	- 会话保持：默认关闭，后端协议为http时支持植入方式的cookie会话保持；	
	
	- cookie超时时间：输入范围0-86400，默认0代表与浏览器同生命周期；	
	
	- 获取真实IP：后端协议为http时，默认开启不可关闭，此时可通过X-Forwarded-For头字段获取客户端真实IP；后端协议为tcp时，支持proxy protocol协议方式透传客户端IP；
	
		注：当后端协议为tcp时，如开启获取真实IP，需在后端服务端完成proxy protocol的相关配置。
		
	- 获取http头字段：用于透传客户端http请求的相关信息。支持通过X-Forwarded-Proto字段获取负载均衡监听协议、通过X-Forwarded-Port字段获取负载均衡监听端口、 通过X-Forwarded-LBIP字段获取负载均衡VIP地址 、通过X-Forwarded-Host字段获取负载均衡监听目的IP（域名）和端口、通过X-Forwarded-Client-Port字段获取客户端源端口；

		![ALB后端转发配置](../../../../image/Networking/ALB/ALB-023.png)	

	**健康检查设置：**

	- 选择健康检查方式：HTTP、TCP、ICMP；

	- 设置检查端口：输入范围1-65535，如不填写默认为后端实例接收负载均衡流量的端口；

	- 检查域名：健康检查的域名。支持输入域名和IP地址。如果输入域名，仅支持大小写字母、数字、英文中划线"-"和点"."，不区分大小写，且不超过255个字符。默认为空，表示健康检查不携带域名。仅健康检查方式为HTTP时支持填写。
	
	- 检查路径：健康检查的URL路径。健康检查的URL路径。最长支持输入1000个字符，必须以"/"开头，支持大小写字母、数字、汉字和英文字符-/.%?#&_;~!()*[]@^:',+=<>{}。%后仅支持输入URL编码后字符。

	- 响应超时时间(s)：输入范围2-60秒,此为健康检查响应的最大超时时间；

	- 健康检查间隔(s):输入范围为5-300秒,此为健康检查的时间间隔；

	- 不健康阈值：输入范围1-5，此为后端实例从成功到失败的连续健康检查失败次数；

	- 健康阈值：输入范围1-5，此为后端实例从失败到成功的连续健康检查成功次数；

	- 正常态码：输入范围2xx（等价于200-299）、3xx（等价于300-399）、4xx（等价于400-499）。仅健康检查方式为HTTP时支持填写。

		![ALB健康检查设置](../../../../image/Networking/ALB/ALB-094.png)

	**添加服务器组：**

	- 选择服务器组类型：虚拟服务器组/实例类型、虚拟服务器组/IP类型、高可用组，或者可以暂不添加；
	
	 
		![ALB服务器组](../../../../image/Networking/ALB/ALB-049.png)
	
	- 虚拟服务器组/实例类型 或 虚拟服务器组/IP类型：系统会自动筛选出当前可以绑定的虚拟服务器组列表，如没有可用的虚拟服务器组，可点击“新建虚拟服务器组”进行创建；	
	
		  注：
		    * 虚拟服务器组/实例类型的后端服务器必须与应用负载均衡处于相同地域下的相同私有网络下。
		    * 当后端服务器位于VPC外（例如：后端服务器通过专线、VPC peering、VPN与应用负载均衡互通）时，请创建IP类型的虚拟服务器组。

	- 高可用组：系统会自动筛选出当前可以绑定的高可用组，如没有可用的高可用组，请前往高可用组页面进行创建；
	
	       注：可选高可用组中的后端服务器必须与应用负载均衡处于相同地域下的相同私有网络下。   

## 管理监听器
<div id="user-content-2"></div>

1. 查看监听详情：通过监听器列表页-操作栏，点击详情可查看监听器详细信息；

2. 启用/禁用监听器：通过监听器列表页-操作栏，可启用、禁用监听器；

3. 编辑监听器：通过监听器列表页-操作栏，可编辑监听器内容（详见下文）；

4. 删除监听器：通过监听器列表页-操作栏，可删除监听器。

![ALB管理监听器](../../../../image/Networking/ALB/ALB-026.png)
	
## 编辑监听器
<div id="user-content-3"></div>

1. 证书：如监听器有绑定的证书，可修改；

2. 空闲连接超时：可修改；

3. 默认后端服务：可替换新的后端服务。注：只能选择与监听器协议匹配的后端服务，如监听协议为http、https，则可选后端协议为http的后端服务；如监听协议为tcp，则可选后端协议为tcp的后端服务。

4. 其他参数项不支持修改。

![ALB编辑监听器](../../../../image/Networking/ALB/ALB-027.png)
	
## 管理监听器关联的转发规则组
<div id="user-content-4"></div>

    注意：仅七层（HTTP/HTTPS）监听支持关联转发规则组，一个监听器只能关联一个转发规则组，同一个负载均衡下的多个监听器可以复用关联同一个转发规则组。

1. 通过监听器列表页-操作栏，点击**更多**弹出管理转发规则组对话框。
2. 在管理转发规则组对话框中，可为监听器关联、解关联及更换转发规则组。

![ALB管理监听器](../../../../image/Networking/ALB/ALB-urlmap3.png)

## 管理证书
<div id="user-content-5"></div>

1. 通过监听器列表页-操作栏，点击**更多**弹出管理证书对话框。
2. 在管理证书对话框中，可配置一个HTTPS/TLS监听绑定多个证书，操作详见[证书管理](../Operation-Guide/Certificates-Management.md)。
